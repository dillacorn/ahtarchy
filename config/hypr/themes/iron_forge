#!/usr/bin/env bash
#
# iron forge

set -euo pipefail

###########   THEME COLORS   ###########
# Hyprland
NEW_ACTIVE_BORDER="ffffffff"
NEW_INACTIVE_BORDER="242a32ff"

# Waybar
W_COLOR="#bcd2d2"
W_BG="#0f1113"
W_HOVER="#1a1f24"
W_FOCUS_BG="#242a32"
W_ACTIVE_BG="#0d0f12"
W_ACTIVE_COLOR="#b74141"
W_URGENT_BG="#a31717"
W_URGENT_COLOR="#ffffff"
W_MODE_BG="#0d0f12"
W_MODE_COLOR="#b74141"
W_CUSTOM_HOVER_BG="#1f2328"
W_BATT_CHARGING_BG="#1f6f6f"
W_BATT_CHARGING_COLOR="#0d0f12"
W_BATT_CRITICAL_BG="#a31717"
W_FOCUS="#242a32"
W_MUTED="#6a7b86"

# Wlogout
WL_COLOR="#bcd2d2"
WL_BG="rgba(15, 17, 19, 0.90)"
WL_BTN_COLOR="#b74141"
WL_BTN_BG="rgba(13, 15, 18, 0.88)"
WL_BTN_HOVER_BG="rgba(31, 35, 40, 0.94)"
WL_BTN_FOCUS_BG="rgba(31, 35, 40, 0.94)"

# Wofi (neutral borders; no global white)
WO_BORDER="1px solid #1a1f24"
WO_BG="#0f1113"
WO_INPUT_COLOR="#c7d9d9"
WO_OUTER_BORDER="1px solid #1a1f24"
WO_OUTER_BG="#0f1113"
WO_TEXT_UNSEL="#6a7b86"

# Mako
MKO_BG="#0f1113"
MKO_TEXT="#cfd6d8"
MKO_BORDER="#1a1f24"
MKO_PROG="#2a9c9c"

###########   FILE PATHS   ###########
HYPR_CONF="$HOME/.config/hypr/hyprland.conf"
WAYBAR_CSS="$HOME/.config/waybar/style.css"
WLOGOUT_CSS="$HOME/.config/wlogout/style.css"
WOFI_CSS="$HOME/.config/wofi/style.css"
MAKO_CONF="$HOME/.config/mako/config"
MICRO_SETTINGS="$HOME/.config/micro/settings.json"
ALACRITTY_CONF="$HOME/.config/alacritty/alacritty.toml"
SPEEDCRUNCH_INI="$HOME/.config/SpeedCrunch/SpeedCrunch.ini"

###########   APPLY CHANGES   ###########
echo "Applying iron forge theme..."

# 1) Hyprland borders
sed -i \
  -e "s/^ *col\.active_border *= *.*/col.active_border = rgba(${NEW_ACTIVE_BORDER})/" \
  -e "s/^ *col\.inactive_border *= *.*/col.inactive_border = rgba(${NEW_INACTIVE_BORDER})/" \
  "$HYPR_CONF"

# 2) Waybar
sed -i \
  -e "2s|.*|@define-color bg-default ${W_BG};|" \
  -e "3s|.*|@define-color bg-hover ${W_CUSTOM_HOVER_BG};|" \
  -e "4s|.*|@define-color bg-focus ${W_FOCUS_BG};|" \
  -e "5s|.*|@define-color bg-active ${W_ACTIVE_BG};|" \
  -e "6s|.*|@define-color bg-urgent ${W_URGENT_BG};|" \
  -e "7s|.*|@define-color bg-charging ${W_BATT_CHARGING_BG};|" \
  -e "8s|.*|@define-color bg-critical ${W_BATT_CRITICAL_BG};|" \
  -e "9s|.*|@define-color color-default ${W_COLOR};|" \
  -e "10s|.*|@define-color color-dark ${W_URGENT_COLOR};|" \
  -e "11s|.*|@define-color color-hover ${W_HOVER};|" \
  "$WAYBAR_CSS"

# 3) Wlogout
sed -i \
  -e "4s|.*|    color: ${WL_COLOR};|" \
  -e "5s|.*|    background-color: ${WL_BG};|" \
  -e "13s|.*|    color: ${WL_BTN_COLOR};|" \
  -e "17s|.*|    background-color: ${WL_BTN_BG};|" \
  -e "23s|.*|    background-color: ${WL_BTN_HOVER_BG};|" \
  -e "27s|.*|    background-color: ${WL_BTN_FOCUS_BG};|" \
  "$WLOGOUT_CSS"

# 4) Wofi (neutral borders restored)
sed -i \
  -e "3s|.*|    border: ${WO_BORDER};|" \
  -e "5s|.*|    background-color: ${WO_BG};|" \
  -e "14s|.*|    color: ${WO_INPUT_COLOR};|" \
  -e "39s|.*|    border: ${WO_OUTER_BORDER};|" \
  -e "41s|.*|    background-color: ${WO_OUTER_BG};|" \
  -e "68s|.*|    color: ${WO_TEXT_UNSEL};|" \
  "$WOFI_CSS"

# 5) Mako
sed -i \
  -e "3s|.*|background-color=${MKO_BG}|" \
  -e "4s|.*|text-color=${MKO_TEXT}|" \
  -e "5s|.*|border-color=${MKO_BORDER}|" \
  -e "6s|.*|progress-color=over ${MKO_PROG}|" \
  "$MAKO_CONF"

# 6) Micro (keep)
sed -i '2s|.*|    "colorscheme": "gotham"|' "$MICRO_SETTINGS"

# 7) Alacritty (keep)
sed -i '331s|.*|  "~\/.config\/alacritty\/themes\/themes\/terafox.toml"|' "$ALACRITTY_CONF"

# 8) SpeedCrunch (keep)
sed -i '5s|.*|Display\\ColorSchemeName=iron_forge|' "$SPEEDCRUNCH_INI"

# Reload Mako
makoctl reload

echo "iron forge theme applied."
