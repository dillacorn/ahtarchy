# ~/.config/hypr/hypridle.conf

general {
    lock_cmd = pidof hyprlock || hyprlock
    before_sleep_cmd = loginctl lock-session
    after_sleep_cmd = sh -c 'sleep 0.5; hyprctl dispatch dpms on'
    ignore_dbus_inhibit = false
}

# toggle Waybar
listener {
    timeout = 60 # 1 minute
    on-timeout = sh -c 'if pgrep -x waybar >/dev/null; then echo running >/tmp/waybar.state; pkill -x waybar; else echo stopped >/tmp/waybar.state; fi'
    on-resume  = sh -c '[ "$(cat /tmp/waybar.state 2>/dev/null)" = running ] && (pgrep -x waybar >/dev/null || (setsid nohup waybar >/dev/null 2>&1 &))'
}

# dim external monitor via DDC
listener {
    timeout = 120 # 2 minutes
    on-timeout = sh -c '~/.config/hypr/scripts/save_brightness.sh; timeout 2 ddcutil setvcp 10 20 || true'
    on-resume  = sh -c 'BRIGHTNESS="$(cat /tmp/brightness_level 2>/dev/null || echo 70)"; timeout 2 ddcutil setvcp 10 "$BRIGHTNESS" || true'
}

# lock session
listener {
    timeout = 180 # 3 minutes
    on-timeout = loginctl lock-session
}

# DPMS off/on
listener {
    timeout = 240 # 4 minutes
    on-timeout = hyprctl dispatch dpms off
    on-resume  = hyprctl dispatch dpms on
}

# suspend
listener {
    timeout = 540 # 9 minutes
    on-timeout = systemctl suspend || loginctl suspend
}
